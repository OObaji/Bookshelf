<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookShelf - Your Personal Digital Library</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?q=80&w=2070&auto=format&fit=crop&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D') no-repeat center center;
            background-size: cover;
            background-attachment: fixed;
            position: relative;
            z-index: 0;
        }
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                circle 450px at var(--mouse-x, 50%) var(--mouse-y, 50%),
                rgba(0, 0, 0, 0.3) 0%,
                rgba(0, 0, 0, 0.8) 100%
            );
            z-index: -1;
            pointer-events: none;
        }
        .font-playfair {
            font-family: 'Playfair Display', serif;
        }
        .feature-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .filter-btn.active, .scripture-filter-btn.active {
            background-color: #2563eb;
            color: white;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .book-card .delete-btn {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        .book-card:hover .delete-btn {
            opacity: 1;
        }
        .verse.highlighted {
            background-color: rgba(250, 204, 21, 0.4); /* yellow-400 with opacity */
            border-radius: 4px;
        }
        .book-card.is-read {
            opacity: 0.7;
        }
        .book-card.is-read .read-badge {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200">

    <!-- Landing Page View -->
    <div id="landingPage">
        <header class="bg-white/90 backdrop-blur-sm shadow-md sticky top-0 z-50">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">
                <div class="font-playfair text-2xl font-bold text-gray-800">BookShelf</div>
                <button class="enter-library-btn bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-blue-700 transition">
                    Enter Library
                </button>
            </div>
        </header>

        <section id="hero" class="text-white py-24 md:py-40">
            <div class="container mx-auto px-6 text-center">
                <h1 class="font-playfair text-4xl md:text-6xl font-bold leading-tight mb-4">Discover Your Next Favorite Book.</h1>
                <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-8">
                    Welcome to BookShelf, your personal digital library. Organize your collection, discover new reads with our AI assistant, and immerse yourself in a world of stories.
                </p>
                <button class="enter-library-btn bg-purple-600 text-white font-bold py-4 px-8 rounded-lg shadow-xl hover:bg-purple-700 transition-transform transform hover:scale-105 text-lg">
                    Explore Your Collection
                </button>
            </div>
        </section>

        <section id="features" class="py-20 bg-gray-100 text-gray-800">
            <div class="container mx-auto px-6">
                <div class="text-center mb-16">
                    <h2 class="font-playfair text-3xl md:text-4xl font-bold">Why You'll Love BookShelf</h2>
                    <p class="text-gray-600 mt-2">Everything you need to manage and grow your digital library.</p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-12">
                    <div class="feature-card bg-white p-8 rounded-xl shadow-lg text-center">
                        <div class="bg-blue-100 text-blue-600 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-6">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                        </div>
                        <h3 class="text-xl font-bold mb-3">AI-Powered Discovery</h3>
                        <p class="text-gray-600">Tell our AI what you're in the mood for, and watch as it populates your library with perfect recommendations.</p>
                    </div>
                    <div class="feature-card bg-white p-8 rounded-xl shadow-lg text-center">
                        <div class="bg-green-100 text-green-600 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-6"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M7 7h.01M7 3h5a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h2zm0 0v1.5M7 14h.01M17 14h.01M17 10h.01M17 7h.01M14 7h.01M14 10h.01M14 14h.01M10 14h.01M10 10h.01M10 7h.01" /></svg></div>
                        <h3 class="text-xl font-bold mb-3">Infinite Organization</h3>
                        <p class="text-gray-600">Create your own custom categories to organize your collection exactly the way you want. Filter and find with ease.</p>
                    </div>
                    <div class="feature-card bg-white p-8 rounded-xl shadow-lg text-center">
                         <div class="bg-purple-100 text-purple-600 rounded-full h-16 w-16 flex items-center justify-center mx-auto mb-6"><svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122" /></svg></div>
                        <h3 class="text-xl font-bold mb-3">Immersive Interface</h3>
                        <p class="text-gray-600">Explore your library with a stunning, interactive background that reacts to your every move, making your visit a unique experience.</p>
                    </div>
                </div>
            </div>
        </section>

        <footer class="bg-gray-800 text-white py-8">
            <div class="container mx-auto px-6 text-center">
                <p>&copy; 2025 BookShelf. All Rights Reserved.</p>
                <p class="text-sm text-gray-400 mt-2">Created with passion for book lovers.</p>
            </div>
        </footer>
    </div>

    <!-- Main Library App View (Initially Hidden) -->
    <div id="libraryApp" class="hidden">
        <nav class="bg-white/80 backdrop-blur-sm shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <button id="logoBtnLibrary" class="font-bold text-xl text-blue-600">BookShelf</button>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <button id="homeBtn" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</button>
                            <button id="scriptureBtnLibrary" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Scripture Study</button>
                            <button id="aboutBtn" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">About</button>
                        </div>
                    </div>
                </div>
            </nav>

        <div class="container mx-auto px-4 py-8">
            <header class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-white">My Personal Book Collection</h1>
                <p class="text-lg text-gray-300 mt-2">A collection of my favorite reads.</p>
            </header>

            <div class="bg-white/10 backdrop-blur-md p-6 rounded-xl shadow-lg mb-12 max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold text-white mb-4 text-center">AI Assistant</h2>
                <p class="text-gray-300 text-center mb-4">Tell the AI what books you'd like to add. (e.g., "5 classic philosophy books")</p>
                <div class="flex gap-2">
                    <input type="text" id="aiPrompt" class="w-full px-4 py-2 border border-gray-500 bg-gray-900/50 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter your request...">
                    <button id="aiAddBtn" class="bg-purple-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-purple-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 flex items-center justify-center">
                        <span id="aiBtnText">Add</span>
                        <div id="aiLoader" class="loader hidden ml-2"></div>
                    </button>
                </div>
            </div>

            <div class="flex flex-col md:flex-row justify-center items-center gap-6 mb-12">
                 <button id="addBookBtn" class="bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 order-1 md:order-2">
                    Add New Book Manually
                </button>
                <div id="filterContainer" class="flex flex-wrap justify-center gap-2 order-2 md:order-1"></div>
            </div>

            <div id="bookList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"></div>
        </div>
    </div>
    
    <!-- About Page View (Initially Hidden) -->
    <div id="aboutPage" class="hidden">
        <nav class="bg-white/80 backdrop-blur-sm shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <button id="logoBtnAbout" class="font-bold text-xl text-blue-600">BookShelf</button>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <button id="homeBtnAbout" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</button>
                            <button id="libraryBtnAbout" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Library</button>
                             <button id="scriptureBtnAbout" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Scripture Study</button>
                        </div>
                    </div>
                </div>
            </nav>
        <div class="container mx-auto px-4 py-16 text-white">
            <div class="max-w-4xl mx-auto bg-black/50 backdrop-blur-lg p-8 md:p-12 rounded-2xl">
                <h1 class="font-playfair text-4xl md:text-5xl font-bold text-center mb-6">About BookShelf</h1>
                <div class="prose prose-lg text-gray-300 max-w-none prose-headings:text-white prose-strong:text-white">
                    <p class="text-xl leading-relaxed">
                        BookShelf was born from a simple idea: to create a beautiful, intelligent, and deeply personal space for book lovers to manage their digital collections. In a world of endless digital noise, we wanted to build a quiet corner of the internet dedicated to the timeless joy of reading.
                    </p>
                    <h2 class="font-playfair mt-10">Our Mission</h2>
                    <p>
                        Our mission is to blend the classic comfort of a personal library with the power of modern technology. We aim to make organizing and discovering books an effortless and delightful experience. Whether you're a casual reader or a dedicated bibliophile, BookShelf is designed to be your perfect companion, helping you keep track of your literary journeys and find your next great adventure.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripture Study Page View (Initially Hidden) -->
    <div id="scripturePage" class="hidden">
        <nav class="bg-white/80 backdrop-blur-sm shadow-md sticky top-0 z-10">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <button id="logoBtnScripture" class="font-bold text-xl text-blue-600">BookShelf</button>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                            <button id="homeBtnScripture" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Home</button>
                            <button id="libraryBtnScripture" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">Library</button>
                            <button id="aboutBtnScripture" class="text-gray-700 hover:bg-blue-600 hover:text-white px-3 py-2 rounded-md text-sm font-medium">About</button>
                        </div>
                    </div>
                </div>
            </nav>
        <div class="container mx-auto px-4 py-8">
            <header class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-white">Scripture Study</h1>
                <p class="text-lg text-gray-300 mt-2">Select a topic to explore relevant books of the Bible.</p>
            </header>
            
            <div class="flex flex-col md:flex-row justify-center items-center gap-4 mb-10">
                <div id="scriptureFilterContainer" class="flex flex-wrap justify-center gap-2"></div>
                <div>
                    <select id="versionSelect" class="bg-white/20 text-white p-2 rounded-lg border-2 border-transparent hover:border-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-400">
                        <option value="kjv" class="text-black">King James Version</option>
                        <option value="web" class="text-black">World English Bible</option>
                        <option value="bbe" class="text-black">Bible in Basic English</option>
                    </select>
                </div>
            </div>

            <div>
                <h2 id="oldTestamentTitle" class="text-3xl font-bold text-white border-b-2 border-blue-400 pb-2 mb-6">Old Testament</h2>
                <div id="oldTestamentGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
            </div>

            <div class="mt-12">
                <h2 id="newTestamentTitle" class="text-3xl font-bold text-white border-b-2 border-blue-400 pb-2 mb-6">New Testament</h2>
                <div id="newTestamentGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4"></div>
            </div>
        </div>
    </div>


    <!-- Modals -->
    <div id="bookModal" class="fixed inset-0 bg-black bg-opacity-60 modal-overlay flex items-center justify-center p-4 hidden"></div>
    <div id="addBookFormContainer" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden"></div>
    <div id="confirmationModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-50"></div>
    <div id="scriptureModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 hidden z-40"></div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- View Switching ---
            const landingPage = document.getElementById('landingPage');
            const libraryApp = document.getElementById('libraryApp');
            const aboutPage = document.getElementById('aboutPage');
            const scripturePage = document.getElementById('scripturePage');
            
            const enterLibraryBtns = document.querySelectorAll('.enter-library-btn');
            const homeBtn = document.getElementById('homeBtn');
            const aboutBtn = document.getElementById('aboutBtn');
            const scriptureBtnLibrary = document.getElementById('scriptureBtnLibrary');
            const logoBtnLibrary = document.getElementById('logoBtnLibrary');
            
            const homeBtnAbout = document.getElementById('homeBtnAbout');
            const libraryBtnAbout = document.getElementById('libraryBtnAbout');
            const scriptureBtnAbout = document.getElementById('scriptureBtnAbout');
            const logoBtnAbout = document.getElementById('logoBtnAbout');

            const homeBtnScripture = document.getElementById('homeBtnScripture');
            const libraryBtnScripture = document.getElementById('libraryBtnScripture');
            const aboutBtnScripture = document.getElementById('aboutBtnScripture');
            const logoBtnScripture = document.getElementById('logoBtnScripture');

            function showView(viewToShow) {
                [landingPage, libraryApp, aboutPage, scripturePage].forEach(view => view.classList.add('hidden'));
                viewToShow.classList.remove('hidden');
            }

            enterLibraryBtns.forEach(btn => btn.addEventListener('click', () => showView(libraryApp)));
            homeBtn.addEventListener('click', () => showView(landingPage));
            aboutBtn.addEventListener('click', () => showView(aboutPage));
            scriptureBtnLibrary.addEventListener('click', () => showView(scripturePage));
            logoBtnLibrary.addEventListener('click', () => showView(landingPage));
            
            homeBtnAbout.addEventListener('click', () => showView(landingPage));
            libraryBtnAbout.addEventListener('click', () => showView(libraryApp));
            scriptureBtnAbout.addEventListener('click', () => showView(scripturePage));
            logoBtnAbout.addEventListener('click', () => showView(landingPage));

            homeBtnScripture.addEventListener('click', () => showView(landingPage));
            libraryBtnScripture.addEventListener('click', () => showView(libraryApp));
            aboutBtnScripture.addEventListener('click', () => showView(aboutPage));
            logoBtnScripture.addEventListener('click', () => showView(landingPage));


            // --- Library App Logic ---
            const bookList = document.getElementById('bookList');
            const addBookBtn = document.getElementById('addBookBtn');
            const addBookFormContainer = document.getElementById('addBookFormContainer');
            const bookModal = document.getElementById('bookModal');
            const filterContainer = document.getElementById('filterContainer');
            const aiPrompt = document.getElementById('aiPrompt');
            const aiAddBtn = document.getElementById('aiAddBtn');
            const aiBtnText = document.getElementById('aiBtnText');
            const aiLoader = document.getElementById('aiLoader');
            const confirmationModal = document.getElementById('confirmationModal');

            let currentFilter = 'All';
            let books = [
                { title: "Steve Jobs", author: "Walter Isaacson", category: "Biography", description: "The exclusive biography of Steve Jobs...", pdfLink: "https://www.google.com/books/edition/Steve_Jobs/8U2oAAAAQBAJ", read: false },
                { title: "Sapiens: A Brief History of Humankind", author: "Yuval Noah Harari", category: "History", description: "A book by Yuval Noah Harari...", pdfLink: "https://www.google.com/books/edition/Sapiens/1v4_CwAAQBAJ", read: true },
            ];
            
            const cardColors = ['from-sky-100 to-blue-200', 'from-green-100 to-emerald-200', 'from-purple-100 to-indigo-200', 'from-yellow-100 to-amber-200', 'from-pink-100 to-rose-200', 'from-red-100 to-orange-200'];

            function renderBooks() {
                if (!bookList) return;
                bookList.innerHTML = '';
                const filteredBooks = books.filter(book => currentFilter === 'All' || book.category === currentFilter);
                if (filteredBooks.length === 0) {
                    bookList.innerHTML = `<p class="text-gray-300 col-span-full text-center">No books found in this category.</p>`;
                    return;
                }
                filteredBooks.forEach((book) => {
                    const card = document.createElement('div');
                    const gradient = cardColors[books.indexOf(book) % cardColors.length];
                    card.className = `book-card relative bg-gradient-to-br ${gradient} rounded-xl shadow-lg overflow-hidden transform hover:-translate-y-2 hover:shadow-2xl hover:-rotate-2 transition-all duration-300 ${book.read ? 'is-read' : ''}`;
                    
                    card.innerHTML = `
                        <div class="p-6 text-gray-800 cursor-pointer" data-book-title="${book.title}">
                            <h3 class="text-xl font-bold text-gray-900 mb-2 truncate">${book.title}</h3>
                            <p class="text-gray-700 font-medium">${book.author}</p>
                            <p class="text-xs font-semibold text-blue-800 mt-3 inline-block bg-blue-200 px-2 py-1 rounded-full">${book.category}</p>
                        </div>
                        <button class="delete-btn absolute top-2 right-2 text-red-500 hover:text-red-700 p-1 rounded-full bg-white/50" data-book-title="${book.title}">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" /></svg>
                        </button>
                        <div class="read-badge hidden absolute top-2 left-2 bg-green-500 text-white rounded-full h-8 w-8 items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                        </div>
                    `;
                    bookList.appendChild(card);
                });
            }
            
            function renderFilters() {
                if (!filterContainer) return;
                const categories = ['All', ...new Set(books.map(book => book.category))];
                filterContainer.innerHTML = '';
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'filter-btn text-white font-medium py-2 px-4 rounded-lg transition hover:bg-blue-500';
                    if (category === currentFilter) button.classList.add('active');
                    button.textContent = category;
                    button.addEventListener('click', () => {
                        currentFilter = category;
                        renderFilters();
                        renderBooks();
                    });
                    filterContainer.appendChild(button);
                });
            }

            function openModal(title) {
                const book = books.find(b => b.title === title);
                if (!book) return;
                
                const readButtonClass = book.read ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-blue-600 hover:bg-blue-700';
                const readButtonText = book.read ? 'Mark as Unread' : 'Mark as Read';

                bookModal.innerHTML = `
                    <div id="modalContent" class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 relative transform scale-95 text-gray-800">
                        <div class="absolute top-4 right-4">
                            <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                        </div>
                        <h2 id="modalTitle" class="text-3xl font-bold mb-2">${book.title}</h2>
                        <p id="modalAuthor" class="text-xl text-gray-700 mb-4">by ${book.author}</p>
                        <p id="modalCategory" class="text-sm text-white bg-blue-500 inline-block px-3 py-1 rounded-full mb-6">${book.category}</p>
                        <p id="modalDescription" class="text-gray-600 mb-8">${book.description || "No description provided."}</p>
                        <div class="flex justify-between items-center flex-wrap gap-4">
                            <a id="modalPdfLink" href="${book.pdfLink || '#'}" target="_blank" rel="noopener noreferrer" class="bg-green-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-green-700 transition ${!book.pdfLink ? 'hidden' : ''}">Read Now</a>
                            <button id="toggleReadBtn" data-book-title="${book.title}" class="${readButtonClass} text-white font-semibold py-2 px-5 rounded-lg transition">${readButtonText}</button>
                            <button id="modalDeleteBtn" data-book-title="${book.title}" class="bg-red-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-red-700 transition">Delete</button>
                        </div>
                    </div>
                `;
                
                bookModal.classList.remove('hidden');
                bookModal.classList.add('flex');
                setTimeout(() => {
                    bookModal.querySelector('#modalContent').classList.remove('scale-95');
                }, 10);

                bookModal.querySelector('#closeModalBtn').addEventListener('click', closeModal);
                bookModal.querySelector('#modalDeleteBtn').addEventListener('click', (e) => {
                    promptForDelete(e.target.dataset.bookTitle);
                });
                bookModal.querySelector('#toggleReadBtn').addEventListener('click', (e) => {
                    toggleReadStatus(e.target.dataset.bookTitle);
                });
            }

            function closeModal() {
                const modalContent = bookModal.querySelector('#modalContent');
                if(modalContent) {
                    modalContent.classList.add('scale-95');
                    setTimeout(() => {
                        bookModal.classList.add('hidden');
                        bookModal.classList.remove('flex');
                        bookModal.innerHTML = '';
                    }, 300);
                }
            }
            
            function toggleReadStatus(title) {
                const book = books.find(b => b.title === title);
                if (book) {
                    book.read = !book.read;
                }
                renderBooks(); // Re-render the book list to show the change
                closeModal(); // Close the modal after the action
            }

            function showAddForm() {
                addBookFormContainer.innerHTML = `
                    <div class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-8 overflow-y-auto max-h-screen">
                        <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Add a New Book</h2>
                        <form id="addBookForm">
                            <div class="mb-4">
                                <label for="title" class="block text-gray-700 font-medium mb-2">Book Title</label>
                                <input type="text" id="title" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div class="mb-4">
                                <label for="author" class="block text-gray-700 font-medium mb-2">Author</label>
                                <input type="text" id="author" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            <div class="mb-4">
                                <label for="category" class="block text-gray-700 font-medium mb-2">Category (or add a new one)</label>
                                <input list="category-list" id="category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                <datalist id="category-list"></datalist>
                            </div>
                            <div class="mb-4">
                                <label for="pdfLink" class="block text-gray-700 font-medium mb-2">PDF/Preview Link (Optional)</label>
                                <input type="url" id="pdfLink" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="https://example.com/book.pdf">
                            </div>
                            <div class="mb-6">
                                <label for="description" class="block text-gray-700 font-medium mb-2">Description (Optional)</label>
                                <textarea id="description" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <div class="flex justify-end gap-4">
                                <button type="button" id="cancelAddBtn" class="bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded-lg hover:bg-gray-400 transition">Cancel</button>
                                <button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Add Book</button>
                            </div>
                        </form>
                    </div>
                `;
                addBookFormContainer.classList.remove('hidden');
                
                const categoryList = addBookFormContainer.querySelector('#category-list');
                categoryList.innerHTML = '';
                [...new Set(books.map(book => book.category))].forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    categoryList.appendChild(option);
                });
                
                addBookFormContainer.querySelector('#cancelAddBtn').addEventListener('click', hideAddForm);
                addBookFormContainer.querySelector('#addBookForm').addEventListener('submit', handleAddBook);
            }

            function hideAddForm() {
                addBookFormContainer.classList.add('hidden');
                addBookFormContainer.innerHTML = '';
            }

            function handleAddBook(e) {
                e.preventDefault();
                const title = e.target.querySelector('#title').value.trim();
                const author = e.target.querySelector('#author').value.trim();
                const category = e.target.querySelector('#category').value.trim();
                const description = e.target.querySelector('#description').value.trim();
                const pdfLink = e.target.querySelector('#pdfLink').value.trim();
                if (title && author && category) {
                    books.push({ title, author, category, description, pdfLink, read: false });
                    if (currentFilter !== 'All' && currentFilter !== category) {
                        currentFilter = category;
                    }
                    renderFilters();
                    renderBooks();
                    hideAddForm();
                }
            }

            function promptForDelete(title) {
                confirmationModal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm mx-auto text-center">
                        <h3 class="text-lg font-bold text-gray-900 mb-4">Are you sure?</h3>
                        <p class="text-gray-600 mb-6">Do you really want to delete this book? This action cannot be undone.</p>
                        <div class="flex justify-center gap-4">
                            <button id="cancelDeleteBtn" class="bg-gray-300 text-gray-800 font-semibold py-2 px-6 rounded-lg hover:bg-gray-400 transition">Cancel</button>
                            <button id="confirmDeleteBtn" data-book-title="${title}" class="bg-red-600 text-white font-semibold py-2 px-6 rounded-lg hover:bg-red-700 transition">Delete</button>
                        </div>
                    </div>
                `;
                confirmationModal.classList.remove('hidden');
                confirmationModal.querySelector('#cancelDeleteBtn').addEventListener('click', () => confirmationModal.classList.add('hidden'));
                confirmationModal.querySelector('#confirmDeleteBtn').addEventListener('click', (e) => {
                    deleteBook(e.target.dataset.bookTitle);
                });
            }

            function deleteBook(title) {
                books = books.filter(book => book.title !== title);
                renderBooks();
                renderFilters();
                confirmationModal.classList.add('hidden');
                closeModal();
            }

            async function handleAiAdd() {
                const prompt = aiPrompt.value.trim();
                if (!prompt) return;
                aiBtnText.classList.add('hidden');
                aiLoader.classList.remove('hidden');
                aiAddBtn.disabled = true;
                try {
                    const chatHistory = [{ role: "user", parts: [{ text: `Generate a list of books based on the following prompt: "${prompt}". Provide the response as a JSON array of objects, each with "title", "author", "category", "description", and an optional "pdfLink" field for a relevant online preview or PDF.` }] }];
                    const payload = {
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json",
                            responseSchema: {
                                type: "ARRAY",
                                items: {
                                    type: "OBJECT",
                                    properties: { "title": { "type": "STRING" }, "author": { "type": "STRING" }, "category": { "type": "STRING" }, "description": { "type": "STRING" }, "pdfLink": {"type": "STRING"} },
                                    required: ["title", "author", "category", "description"]
                                }
                            }
                        }
                    };
                    const apiKey = "AIzaSyD6kZtsCBwNR1FVRFOTiEvfjhOy4TJFpIM";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]) {
                        const newBooks = JSON.parse(result.candidates[0].content.parts[0].text);
                        newBooks.forEach(newBook => {
                            if (!books.some(book => book.title.toLowerCase() === newBook.title.toLowerCase())) {
                                books.push({ ...newBook, read: false });
                            }
                        });
                        renderFilters();
                        renderBooks();
                        aiPrompt.value = '';
                    } else {
                        console.error("Unexpected API response structure:", result);
                        alert("The AI returned an unexpected response.");
                    }
                } catch (error) {
                    console.error('Error fetching from Gemini API:', error);
                    alert('An error occurred while fetching books from the AI.');
                } finally {
                    aiBtnText.classList.remove('hidden');
                    aiLoader.classList.add('hidden');
                    aiAddBtn.disabled = false;
                }
            }
            
            // --- Scripture Study Logic ---
            const oldTestamentGrid = document.getElementById('oldTestamentGrid');
            const newTestamentGrid = document.getElementById('newTestamentGrid');
            const scriptureModal = document.getElementById('scriptureModal');
            const scriptureFilterContainer = document.getElementById('scriptureFilterContainer');
            const oldTestamentTitle = document.getElementById('oldTestamentTitle');
            const newTestamentTitle = document.getElementById('newTestamentTitle');
            const versionSelect = document.getElementById('versionSelect');

            let currentScriptureCategory = 'All Books';
            let currentBibleVersion = 'kjv';

            const scriptureCategories = {
                "Finance & Stewardship": ["Proverbs", "Malachi", "Luke", "2 Corinthians", "Haggai"],
                "Faith & Trust": ["Genesis", "Psalms", "Proverbs", "Isaiah", "Habakkuk", "Matthew", "Romans", "Hebrews", "James"],
                "Love & Compassion": ["Song of Solomon", "Luke", "John", "Romans", "1 Corinthians", "Galatians", "Ephesians", "1 John"],
                "Wisdom & Guidance": ["Job", "Psalms", "Proverbs", "Ecclesiastes", "James"],
                "Law & History": ["Genesis", "Exodus", "Leviticus", "Numbers", "Deuteronomy", "Joshua", "Judges", "1 Samuel", "2 Samuel", "1 Kings", "2 Kings", "Acts"],
                "Prophecy & End Times": ["Isaiah", "Jeremiah", "Ezekiel", "Daniel", "Revelation"]
            };

            const bibleBooks = {
                oldTestament: [
                    { name: "Genesis", chapters: 50 }, { name: "Exodus", chapters: 40 }, { name: "Leviticus", chapters: 27 }, { name: "Numbers", chapters: 36 }, { name: "Deuteronomy", chapters: 34 }, { name: "Joshua", chapters: 24 }, { name: "Judges", chapters: 21 }, { name: "Ruth", chapters: 4 }, { name: "1 Samuel", chapters: 31 }, { name: "2 Samuel", chapters: 24 }, { name: "1 Kings", chapters: 22 }, { name: "2 Kings", chapters: 25 }, { name: "1 Chronicles", chapters: 29 }, { name: "2 Chronicles", chapters: 36 }, { name: "Ezra", chapters: 10 }, { name: "Nehemiah", chapters: 13 }, { name: "Esther", chapters: 10 }, { name: "Job", chapters: 42 }, { name: "Psalms", chapters: 150 }, { name: "Proverbs", chapters: 31 }, { name: "Ecclesiastes", chapters: 12 }, { name: "Song of Solomon", chapters: 8 }, { name: "Isaiah", chapters: 66 }, { name: "Jeremiah", chapters: 52 }, { name: "Lamentations", chapters: 5 }, { name: "Ezekiel", chapters: 48 }, { name: "Daniel", chapters: 12 }, { name: "Hosea", chapters: 14 }, { name: "Joel", chapters: 3 }, { name: "Amos", chapters: 9 }, { name: "Obadiah", chapters: 1 }, { name: "Jonah", chapters: 4 }, { name: "Micah", chapters: 7 }, { name: "Nahum", chapters: 3 }, { name: "Habakkuk", chapters: 3 }, { name: "Zephaniah", chapters: 3 }, { name: "Haggai", chapters: 2 }, { name: "Zechariah", chapters: 14 }, { name: "Malachi", chapters: 4 }
                ],
                newTestament: [
                    { name: "Matthew", chapters: 28 }, { name: "Mark", chapters: 16 }, { name: "Luke", chapters: 24 }, { name: "John", chapters: 21 }, { name: "Acts", chapters: 28 }, { name: "Romans", chapters: 16 }, { name: "1 Corinthians", chapters: 16 }, { name: "2 Corinthians", chapters: 13 }, { name: "Galatians", chapters: 6 }, { name: "Ephesians", chapters: 6 }, { name: "Philippians", chapters: 4 }, { name: "Colossians", chapters: 4 }, { name: "1 Thessalonians", chapters: 5 }, { name: "2 Thessalonians", chapters: 3 }, { name: "1 Timothy", chapters: 6 }, { name: "2 Timothy", chapters: 4 }, { name: "Titus", chapters: 3 }, { name: "Philemon", chapters: 1 }, { name: "Hebrews", chapters: 13 }, { name: "James", chapters: 5 }, { name: "1 Peter", chapters: 5 }, { name: "2 Peter", chapters: 3 }, { name: "1 John", chapters: 5 }, { name: "2 John", chapters: 1 }, { name: "3 John", chapters: 1 }, { name: "Jude", chapters: 1 }, { name: "Revelation", chapters: 22 }
                ]
            };

            function renderScriptureCategoryFilters() {
                const categories = ["All Books", ...Object.keys(scriptureCategories)];
                scriptureFilterContainer.innerHTML = '';
                categories.forEach(category => {
                    const button = document.createElement('button');
                    button.className = 'scripture-filter-btn text-white font-medium py-2 px-4 rounded-lg transition hover:bg-blue-500';
                    if (category === currentScriptureCategory) button.classList.add('active');
                    button.textContent = category;
                    button.addEventListener('click', () => {
                        currentScriptureCategory = category;
                        renderScriptureMenu();
                        renderScriptureCategoryFilters();
                    });
                    scriptureFilterContainer.appendChild(button);
                });
            }

            function renderScriptureMenu() {
                oldTestamentGrid.innerHTML = '';
                newTestamentGrid.innerHTML = '';

                const allowedBooks = currentScriptureCategory === 'All Books' ? null : scriptureCategories[currentScriptureCategory];
                
                const oldTestamentBooks = bibleBooks.oldTestament.filter(book => !allowedBooks || allowedBooks.includes(book.name));
                const newTestamentBooks = bibleBooks.newTestament.filter(book => !allowedBooks || allowedBooks.includes(book.name));

                oldTestamentTitle.classList.toggle('hidden', oldTestamentBooks.length === 0);
                newTestamentTitle.classList.toggle('hidden', newTestamentBooks.length === 0);
                
                oldTestamentBooks.forEach(book => oldTestamentGrid.appendChild(createScriptureCard(book)));
                newTestamentBooks.forEach(book => newTestamentGrid.appendChild(createScriptureCard(book)));
            }

            function createScriptureCard(book) {
                const card = document.createElement('div');
                card.className = 'bg-blue-200 text-blue-900 p-4 rounded-lg text-center font-semibold shadow-md cursor-pointer hover:bg-blue-300 hover:shadow-lg transition';
                card.textContent = book.name;
                card.dataset.bookName = book.name;
                card.dataset.chapters = book.chapters;
                return card;
            }

            function openScriptureModal(bookName, chapterCount) {
                scriptureModal.classList.remove('hidden');
                let chapterButtonsHTML = '';
                for (let i = 1; i <= chapterCount; i++) {
                    chapterButtonsHTML += `<button class="chapter-btn bg-gray-200 text-gray-800 w-12 h-12 rounded-md hover:bg-blue-500 hover:text-white transition" data-chapter="${i}">${i}</button>`;
                }

                scriptureModal.innerHTML = `
                    <div class="bg-white rounded-xl shadow-2xl w-full max-w-3xl relative text-gray-800 flex flex-col max-h-[90vh]">
                        <div class="p-4 border-b">
                            <h2 class="text-2xl font-bold text-center">${bookName}</h2>
                            <button id="closeScriptureModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                        </div>
                        <div id="scriptureContent" class="p-6 overflow-y-auto">
                            <h3 class="text-xl font-semibold mb-4">Select a Chapter</h3>
                            <div class="grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-2">
                                ${chapterButtonsHTML}
                            </div>
                        </div>
                    </div>
                `;
            }
            
            async function fetchAndDisplayChapter(bookName, chapterNumber) {
                const contentDiv = document.getElementById('scriptureContent');
                contentDiv.innerHTML = '<div class="flex justify-center items-center h-48"><div class="loader"></div></div>';
                
                try {
                    const response = await fetch(`https://bible-api.com/${bookName}+${chapterNumber}?translation=${currentBibleVersion}`);
                    if (!response.ok) throw new Error('Network response was not ok.');
                    const data = await response.json();
                    
                    let versesHTML = `<h3 class="text-2xl font-bold mb-4">${data.reference} (${data.translation_name})</h3><div class="space-y-2">`;
                    data.verses.forEach(verse => {
                        versesHTML += `<p class="verse p-1 cursor-pointer"><strong class="text-blue-700 pr-2">${verse.verse}.</strong>${verse.text.trim()}</p>`;
                    });
                    versesHTML += `</div>`;
                    contentDiv.innerHTML = versesHTML;
                } catch (error) {
                    console.error("Failed to fetch scripture:", error);
                    contentDiv.innerHTML = `<p class="text-red-500 text-center">Sorry, the scripture text could not be loaded at this time. Please try again later.</p>`;
                }
            }
            
            // --- Event Delegation for Scripture Page ---
            scripturePage.addEventListener('click', (e) => {
                const card = e.target.closest('[data-book-name]');
                if (card) {
                    openScriptureModal(card.dataset.bookName, card.dataset.chapters);
                }
            });

            scriptureModal.addEventListener('click', (e) => {
                if (e.target.id === 'closeScriptureModal') {
                    scriptureModal.classList.add('hidden');
                }
                const chapterBtn = e.target.closest('.chapter-btn');
                if (chapterBtn) {
                    const bookName = scriptureModal.querySelector('h2').textContent;
                    fetchAndDisplayChapter(bookName, chapterBtn.dataset.chapter);
                }
                const verse = e.target.closest('.verse');
                if (verse) {
                    verse.classList.toggle('highlighted');
                }
            });
            
            versionSelect.addEventListener('change', (e) => {
                currentBibleVersion = e.target.value;
            });

            // --- Event Listeners ---
            addBookBtn.addEventListener('click', showAddForm);
            
            bookList.addEventListener('click', (e) => {
                const cardBody = e.target.closest('[data-book-title]');
                const deleteButton = e.target.closest('.delete-btn');
                if (deleteButton) {
                    e.stopPropagation();
                    promptForDelete(deleteButton.dataset.bookTitle);
                } else if (cardBody) {
                    openModal(cardBody.dataset.bookTitle);
                }
            });

            bookModal.addEventListener('click', (e) => { if (e.target === bookModal) closeModal(); });
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && !bookModal.classList.contains('hidden')) closeModal(); });
            aiAddBtn.addEventListener('click', handleAiAdd);
            aiPrompt.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleAiAdd(); });

            document.addEventListener('mousemove', (e) => {
                document.body.style.setProperty('--mouse-x', e.clientX + 'px');
                document.body.style.setProperty('--mouse-y', e.clientY + 'px');
            });

            renderFilters();
            renderBooks();
            renderScriptureCategoryFilters();
            renderScriptureMenu();
        });
    </script>
</body>
</html>
